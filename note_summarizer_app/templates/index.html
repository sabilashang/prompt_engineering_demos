<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Summarizer - AI-Powered Text Summary</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="icon">üìù</span>
                <h1>Note Summarizer</h1>
            </div>
            <p class="subtitle">AI-Powered Text Summarization</p>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Input Section -->
            <section class="input-section card">
                <div class="section-header">
                    <h2>Your Text</h2>
                    <span id="charCount" class="char-count">0 / 10,000</span>
                </div>
                
                <textarea 
                    id="inputText" 
                    class="text-input" 
                    placeholder="Paste your text here (minimum 50 characters)...

Try summarizing:
‚Ä¢ Meeting notes
‚Ä¢ Articles and blog posts
‚Ä¢ Research papers
‚Ä¢ Long emails
‚Ä¢ Documentation
‚Ä¢ Any text content you need condensed!"
                    maxlength="10000"
                ></textarea>

                <!-- Summary Type Selection -->
                <div class="summary-types">
                    <label class="summary-type-label">Summary Type:</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="summaryType" value="concise" checked>
                            <span>Concise (3 bullets)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="summaryType" value="detailed">
                            <span>Detailed</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="summaryType" value="keywords">
                            <span>Keywords</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="summaryType" value="tldr">
                            <span>TL;DR</span>
                        </label>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="button-group">
                    <button id="summarizeBtn" class="btn btn-primary">
                        <span class="btn-text">Summarize</span>
                        <span class="btn-loader" style="display: none;">‚è≥ Summarizing...</span>
                    </button>
                    <button id="clearBtn" class="btn btn-secondary">Clear</button>
                </div>
            </section>

            <!-- Output Section -->
            <section class="output-section card" id="outputSection" style="display: none;">
                <div class="section-header">
                    <h2>Summary</h2>
                    <button id="copyBtn" class="btn btn-small">Copy</button>
                </div>
                
                <div id="summaryOutput" class="summary-output"></div>

                <!-- Stats -->
                <div class="stats">
                    <div class="stat-item">
                        <span class="stat-label">Original:</span>
                        <span id="originalLength" class="stat-value">0 chars</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Summary:</span>
                        <span id="summaryLength" class="stat-value">0 chars</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Reduction:</span>
                        <span id="reductionPercent" class="stat-value">0%</span>
                    </div>
                </div>
            </section>

            <!-- Error Section -->
            <div id="errorSection" class="error-section" style="display: none;">
                <span class="error-icon">‚ö†Ô∏è</span>
                <span id="errorMessage"></span>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Powered by OpenRouter API ‚Ä¢ <a href="/api/info" target="_blank">API Info</a></p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const inputText = document.getElementById('inputText');
        const charCount = document.getElementById('charCount');
        const summarizeBtn = document.getElementById('summarizeBtn');
        const clearBtn = document.getElementById('clearBtn');
        const copyBtn = document.getElementById('copyBtn');
        const outputSection = document.getElementById('outputSection');
        const summaryOutput = document.getElementById('summaryOutput');
        const errorSection = document.getElementById('errorSection');
        const errorMessage = document.getElementById('errorMessage');
        const originalLength = document.getElementById('originalLength');
        const summaryLength = document.getElementById('summaryLength');
        const reductionPercent = document.getElementById('reductionPercent');

        // Update character count
        inputText.addEventListener('input', () => {
            const length = inputText.value.length;
            charCount.textContent = `${length} / 10,000`;
            
            if (length > 9500) {
                charCount.style.color = '#e74c3c';
            } else {
                charCount.style.color = '#7f8c8d';
            }
        });

        // Get selected summary type
        function getSummaryType() {
            const selected = document.querySelector('input[name="summaryType"]:checked');
            return selected ? selected.value : 'concise';
        }

        // Show error
        function showError(message) {
            errorMessage.textContent = message;
            errorSection.style.display = 'flex';
            outputSection.style.display = 'none';
            
            setTimeout(() => {
                errorSection.style.display = 'none';
            }, 5000);
        }

        // Show summary
        function showSummary(data) {
            summaryOutput.textContent = data.summary;
            originalLength.textContent = `${data.original_length} chars`;
            summaryLength.textContent = `${data.summary_length} chars`;
            
            const reduction = Math.round((1 - data.summary_length / data.original_length) * 100);
            reductionPercent.textContent = `${reduction}%`;
            
            outputSection.style.display = 'block';
            errorSection.style.display = 'none';
            
            // Scroll to output
            outputSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Summarize button click
        summarizeBtn.addEventListener('click', async () => {
            const text = inputText.value.trim();
            
            // Validation
            if (!text) {
                showError('Please enter some text to summarize');
                return;
            }
            
            if (text.length < 50) {
                showError('Text too short. Please provide at least 50 characters.');
                return;
            }
            
            // Show loading state
            summarizeBtn.disabled = true;
            document.querySelector('.btn-text').style.display = 'none';
            document.querySelector('.btn-loader').style.display = 'inline';
            
            try {
                const response = await fetch('/summarize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        summary_type: getSummaryType()
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showSummary(data);
                } else {
                    showError(data.error || 'Failed to generate summary');
                }
            } catch (error) {
                showError('Network error. Please try again.');
                console.error('Error:', error);
            } finally {
                // Reset button state
                summarizeBtn.disabled = false;
                document.querySelector('.btn-text').style.display = 'inline';
                document.querySelector('.btn-loader').style.display = 'none';
            }
        });

        // Clear button click
        clearBtn.addEventListener('click', () => {
            inputText.value = '';
            charCount.textContent = '0 / 10,000';
            outputSection.style.display = 'none';
            errorSection.style.display = 'none';
            inputText.focus();
        });

        // Copy button click
        copyBtn.addEventListener('click', () => {
            const text = summaryOutput.textContent;
            navigator.clipboard.writeText(text).then(() => {
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úì Copied!';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            });
        });

        // Enter key to submit (Ctrl/Cmd + Enter)
        inputText.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                summarizeBtn.click();
            }
        });
    </script>
</body>
</html>

